// Generated by CoffeeScript 1.10.0
(function() {
  var analyze, churn, coffee, cyclomaticComplexity, files, fs, functionLength, glob, gpa, letterGrade, nestedCoffeeScriptPattern, report, tokenComplexity, tokens, version;

  version = require("../package.json").version;

  churn = require("./metrics/churn");

  tokenComplexity = require("./metrics/token_complexity");

  cyclomaticComplexity = require("./metrics/cyclomatic_complexity");

  functionLength = require("./metrics/function_length");

  letterGrade = require("./metrics/letter_grade");

  gpa = require("./metrics/gpa");

  coffee = require("coffee-script");

  tokens = coffee.tokens;

  fs = require("fs");

  glob = require("glob");

  nestedCoffeeScriptPattern = function(path) {
    return path + "/**/*\.+(coffee|coffee\.md|litcoffee)";
  };

  files = function(paths) {
    return paths.reduce(function(list, path) {
      var pattern, stats;
      stats = fs.lstatSync(path);
      if (stats.isFile()) {
        list.push(path);
      } else if (stats.isDirectory()) {
        pattern = nestedCoffeeScriptPattern(path);
        list = list.concat(glob.sync(pattern));
      }
      return list;
    }, []);
  };

  analyze = function(filePath) {
    var file, fileTokens, numericGrade, summary;
    file = fs.readFileSync(filePath, "utf8");
    fileTokens = tokens(file, {
      literate: coffee.helpers.isLiterate(filePath)
    });
    summary = {
      churn: churn(filePath),
      functionLength: functionLength(file),
      cyclomaticComplexity: cyclomaticComplexity(file),
      tokenComplexity: tokenComplexity(fileTokens),
      tokenCount: fileTokens.length
    };
    numericGrade = gpa(file, summary);
    summary.gpa = numericGrade;
    summary.letterGrade = letterGrade(numericGrade);
    return summary;
  };

  report = function(filePaths, opts) {
    var scores;
    if (opts == null) {
      opts = {};
    }
    scores = files(filePaths).reduce(function(hash, file) {
      hash[file] = analyze(file);
      return hash;
    }, {});
    return JSON.stringify(scores, null, opts.indentSpace);
  };

  exports.clog = {
    report: report,
    VERSION: version
  };

}).call(this);
